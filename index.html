<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Project Management Quiz</title>
<style>
  body { font-family: Arial, sans-serif; background: #f5f5f5; color: #222; display: flex; justify-content: center; padding: 20px; }
  .container { background: #fff; padding: 20px; border-radius: 16px; max-width: 480px; width: 100%; }
  .question { margin-bottom: 15px; font-size: 1.1em; }
  .question img { max-width: 100%; margin-top: 10px; border-radius: 12px; display: block; }
  .options button { display: block; width: 100%; padding: 10px; margin: 5px 0; border-radius: 12px; cursor: pointer; border: none; }
  .options button.correct { background: #4caf50; color: #fff; }
  .options button.wrong { background: #f44336; color: #fff; }
  #nextBtn { padding: 12px; margin-top: 10px; width: 100%; background: #4caf50; color: #fff; border: none; border-radius: 12px; cursor: pointer; }
</style>
</head>
<body>
<div class="container">
  <div class="question" id="question"></div>
  <div class="options" id="options"></div>
  <button id="nextBtn" onclick="nextQuestion()" disabled>Next Question</button>
</div>

<script>
const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSGovyAXUEPrHKj8qH2VEITgb424ghBN_uWJWQzYgkAL9jFeldMdO-L1-Rd522rTdyrIyYH/pub?output=csv";

let questions = [];
let current = 0;
let score = 0;
const questionsWithImages = [102,127,128,293,320,361]; // 1-based indices

// Fetch CSV and parse
fetch(SHEET_CSV_URL)
  .then(response => response.text())
  .then(csv => {
    questions = parseCSV(csv);
    loadQuestion();
  });

function parseCSV(csvText) {
  const lines = csvText.split("\n");
  const result = [];
  const headers = lines[0].split(",");
  
  for(let i=1; i<lines.length; i++){
    const line = lines[i];
    if(!line.trim()) continue;
    const cols = line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/); // handle commas inside quotes
    const q = {
      q: cols[0].replace(/(^"|"$)/g,""),
      options: cols.slice(1,5).map(o => o.replace(/(^"|"$)/g,"")),
      answer: cols[5]?.replace(/(^"|"$)/g,"") || "",
      img: questionsWithImages.includes(i) ? `images/question${i}.jpg` : null
    };
    result.push(q);
  }
  return result;
}

function loadQuestion() {
  const q = questions[current];
  const qDiv = document.getElementById("question");
  qDiv.innerHTML = q.q;
  if(q.img){
    const img = document.createElement("img");
    img.src = q.img;
    qDiv.appendChild(img);
  }

  const optionsDiv = document.getElementById("options");
  optionsDiv.innerHTML = "";
  q.options.forEach(opt => {
    const btn = document.createElement("button");
    btn.innerText = opt;
    btn.onclick = () => checkAnswer(btn, opt);
    optionsDiv.appendChild(btn);
  });

  document.getElementById("nextBtn").disabled = true;
}

function checkAnswer(btn, selected) {
  const q = questions[current];
  const buttons = document.querySelectorAll(".options button");
  buttons.forEach(b => {
    b.disabled = true;
    if(b.innerText === q.answer) b.classList.add("correct");
    else if(b.innerText === selected) b.classList.add("wrong");
  });
  if(selected === q.answer) score++;
  document.getElementById("nextBtn").disabled = false;
}

function nextQuestion() {
  current++;
  if(current < questions.length) loadQuestion();
  else alert(`Quiz Finished! Score: ${score}/${questions.length}`);
}
</script>
</body>
</html>
